<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Pusher Platform example</title>
  </head>
  <body>
    <h1>Pusher Platform example</h1>
    <p>
      This app is the "hello world" of Pusher Platform.
      The app subscribes to a feed.
      The latest items are shown below.
      You can append things to the feed using the form below it.
      View source or see <a href="https://github.com/pusher/pusher-platform-js">the repository</a> for more info.
    </p>

    <ol id="feed_items">
    </ol>

    <input type="text" id="item_val"/>
    <button id="append_item">Append</button>

    <!-- change this URL to "./target/pusher-platform.js" for the built version in the repo -->
    <script src="https://js.pusher.com/platform/latest/pusher-platform.js"></script>
    <script>
      var app = new PusherPlatform.App({
        appId: "d41c21c3-549a-4d9d-a368-f2b058e0655b", // an example app provided by Pusher
        // This token provides full permissions (SUBSCRIBE and POST) for this app ^
        authorizer: new PusherPlatform.SimpleTokenAuthorizer("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJkNDFjMjFjMy01NDlhLTRkOWQtYTM2OC1mMmIwNThlMDY1NWIiLCJpc3MiOiI4MDc4YjY5MS02ZWJjLTQ0YWEtOTUwMS1jYWIyOWVhZGMyZjUiLCJncmFudHMiOnsiL2FwcHMvZDQxYzIxYzMtNTQ5YS00ZDlkLWEzNjgtZjJiMDU4ZTA2NTViLyoqIjpbIioiXX0sImlhdCI6MTQ4NDkyMzIzMH0.rNt_9xqt8kgm0DqTGaXp7ezKYCmFxniilU86PlFooYk")
      });
      var notificationsFeed = app.feed("notifications");
      notificationsFeed.subscribe({
        lastEventId: "0",
        onOpen: () => {
          console.log("Subscription opened");
        },
        onItem: (item) => {
          var itemEl = document.createElement("li");
          itemEl.innerText = JSON.stringify(item);
          document.getElementById("feed_items").appendChild(itemEl);
        },
        onError: (err) => {
          console.error("Error subscribing to notifications:", err);
        }
      });

      // Using the same feed as above we can append any value:
      document.getElementById("append_item").addEventListener("click", () => {
        notificationsFeed.append(document.getElementById("item_val").value)
          .then((response) => console.log("Success response when appending:", response))
          .catch((err) => console.error("Error:", err));
      });
    </script>
  </body>
</html>
